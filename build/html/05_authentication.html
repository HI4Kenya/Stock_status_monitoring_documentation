

<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Authentication and authorization &mdash; Supply Chain 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="top" title="Supply Chain 0.1 documentation" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Supply Chain 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Authentication and authorization</a><ul>
<li><a class="reference internal" href="#id1">Authentication</a><ul>
<li><a class="reference internal" href="#session-authentication">Session Authentication</a><ul>
<li><a class="reference internal" href="#logging-in">Logging in</a></li>
<li><a class="reference internal" href="#logging-out">Logging out</a></li>
<li><a class="reference internal" href="#getting-user-details-after-login">Getting user details after login</a></li>
</ul>
</li>
<li><a class="reference internal" href="#oauth2-authentication">OAuth2 Authentication</a><ul>
<li><a class="reference internal" href="#a-simple-oauth2-workflow">A simple OAuth2 workflow</a><ul>
<li><a class="reference internal" href="#registering-a-new-application">Registering a new &#8220;application&#8221;</a></li>
<li><a class="reference internal" href="#authenticating-using-oauth2-tokens">Authenticating using OAuth2 tokens</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id2">Authorization</a><ul>
<li><a class="reference internal" href="#understanding-the-role-based-access-control-setup">Understanding the role based access control setup</a></li>
<li><a class="reference internal" href="#users-and-counties">Users and counties</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-up-users-permissions-and-groups">Setting up users, permissions and groups</a><ul>
<li><a class="reference internal" href="#permissions">Permissions</a></li>
<li><a class="reference internal" href="#groups">Groups</a><ul>
<li><a class="reference internal" href="#creating-a-new-role">Creating a new role</a></li>
<li><a class="reference internal" href="#updating-an-existing-role">Updating an existing role</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#user-management">User management</a><ul>
<li><a class="reference internal" href="#user-registration-sign-up">User registration ( sign up )</a></li>
<li><a class="reference internal" href="#linking-users-to-groups">Linking users to groups</a></li>
<li><a class="reference internal" href="#updating-user-details">Updating user details</a></li>
<li><a class="reference internal" href="#password-changes">Password changes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/05_authentication.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="authentication-and-authorization">
<h1>Authentication and authorization<a class="headerlink" href="#authentication-and-authorization" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/">Authentication</a> is the process of associating an API request with a specific
user, while <a class="reference external" href="http://www.django-rest-framework.org/api-guide/permissions/">authorization</a> determines if the user has permission to perform
the requested operation.</p>
<div class="section" id="id1">
<h2>Authentication<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>A system like this has to consider the needs of programmatic clients
( like integrations into other systems ) and the needs of &#8220;actual users&#8221;
( in this case people logged in to the web interfaces ).</p>
<p>The MFL API server supports both session ( cookie based ) and OAuth 2 ( token based ) authentication. For both approaches, the production API server <strong>must be run over HTTPS</strong>.</p>
<div class="section" id="session-authentication">
<h3>Session Authentication<a class="headerlink" href="#session-authentication" title="Permalink to this headline">¶</a></h3>
<div class="section" id="logging-in">
<h4>Logging in<a class="headerlink" href="#logging-in" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">POST</span></code> the credentials to <code class="docutils literal"><span class="pre">/api/rest-auth/login/</span></code>. The payload should be
similar to the example below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;username&quot;</span><span class="o">:</span> <span class="s2">&quot;hakunaruhusa@mfltest.slade360.co.ke&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="o">:</span> <span class="s2">&quot;hakunaruhusa&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A successful login will have a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">200</span> <span class="pre">OK</span></code> response. The response payload
will have a single <code class="docutils literal"><span class="pre">key</span></code> parameter: a Django Rest Framework <a class="reference external" href="http://www.django-rest-framework.org/api-guide/authentication/#tokenauthentication">TokenAuthentication</a> key. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;f9a978cd00e9dc0ebfe97d633d98bde4b35f9279&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note that the <code class="docutils literal"><span class="pre">username</span></code> is actually an email address.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We discourage the use of token authentication. Kindly see the section on
OAuth2 below.</p>
</div>
</div>
<div class="section" id="logging-out">
<h4>Logging out<a class="headerlink" href="#logging-out" title="Permalink to this headline">¶</a></h4>
<p>Send an empty ( no payload ) <code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">/api/rest-auth/logout/</span></code>.</p>
<p>A successful logout will get back a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">200</span> <span class="pre">OK</span></code> response, and a success
message similar to the one below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;success&quot;</span><span class="o">:</span> <span class="s2">&quot;Successfully logged out.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-user-details-after-login">
<h4>Getting user details after login<a class="headerlink" href="#getting-user-details-after-login" title="Permalink to this headline">¶</a></h4>
<p>After a user is logged in, a typical client ( such as a web application ) will
need to get additional information about the user. This additional information
includes permissions.</p>
<p>If the user is logged in, a <code class="docutils literal"><span class="pre">GET</span></code> to <code class="docutils literal"><span class="pre">/api/rest-auth/user/</span></code> will get back
a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">200</span> <span class="pre">OK</span></code> response and a user details payload similar to this example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;short_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Serikali&quot;</span><span class="p">,</span>
    <span class="s2">&quot;full_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Serikali Kuu &quot;</span><span class="p">,</span>
    <span class="s2">&quot;all_permissions&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;common.add_town&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oauth2_provider.change_accesstoken&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mfl_gis.delete_wardboundary&quot;</span><span class="p">,</span>
        <span class="s2">&quot;auth.add_permission&quot;</span><span class="p">,</span>
        <span class="s2">&quot;chul.change_approvalstatus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;facilities.delete_facilitytype&quot;</span><span class="p">,</span>
        <span class="c1">// a long list of permissions; truncated for brevity</span>
    <span class="p">],</span>
    <span class="s2">&quot;user_permissions&quot;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s2">&quot;groups&quot;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s2">&quot;last_login&quot;</span><span class="o">:</span> <span class="s2">&quot;2015-05-04T16:33:36.085065Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_superuser&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;serikalikuu@mfltest.slade360.co.ke&quot;</span><span class="p">,</span>
    <span class="s2">&quot;first_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Serikali&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Kuu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;other_names&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="o">:</span> <span class="s2">&quot;serikalikuu&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_staff&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;is_active&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;date_joined&quot;</span><span class="o">:</span> <span class="s2">&quot;2015-05-03T02:39:03.440962Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_national&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;requires_password_change&quot;</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the user is not logged in, the return message will be a
<code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">403</span> <span class="pre">FORBIDDEN</span></code> with the following message:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;detail&quot;</span><span class="o">:</span> <span class="s2">&quot;Authentication credentials were not provided.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If a user needs to change their password e.g because it was created by an
admin and must be changed on first login, the <code class="docutils literal"><span class="pre">requires_password_change</span></code>
boolean property will be set to <code class="docutils literal"><span class="pre">true</span></code>.</p>
<p class="last"><strong>Every well behaved web client should observe this property</strong> and
implement the appropriate &#8220;roadblock&#8221;.</p>
</div>
</div>
</div>
<div class="section" id="oauth2-authentication">
<h3>OAuth2 Authentication<a class="headerlink" href="#oauth2-authentication" title="Permalink to this headline">¶</a></h3>
<p>You can learn all that you need to know about OAuth2 by reading <a class="reference external" href="https://tools.ietf.org/html/rfc6749">rfc6749</a>.</p>
<div class="section" id="a-simple-oauth2-workflow">
<h4>A simple OAuth2 workflow<a class="headerlink" href="#a-simple-oauth2-workflow" title="Permalink to this headline">¶</a></h4>
<p>If you are in too much of a hurry to read all that, here is what you
should do:</p>
<div class="section" id="registering-a-new-application">
<h5>Registering a new &#8220;application&#8221;<a class="headerlink" href="#registering-a-new-application" title="Permalink to this headline">¶</a></h5>
<p>You should know the user ID of the user that you&#8217;d like to register an
application for. You can obtain that ID from the user details API described
above or from <code class="docutils literal"><span class="pre">/api/users/</span></code>.</p>
<p>You need to know the <code class="docutils literal"><span class="pre">authorization_grant_type</span></code> that you&#8217;d like for the new
application. For the example below, we will use <code class="docutils literal"><span class="pre">password</span></code>. If you do not
know what to choose, read <a class="reference external" href="https://tools.ietf.org/html/rfc6749">rfc6749</a> .</p>
<p>The next decision is the choice of <code class="docutils literal"><span class="pre">client_type</span></code>. For the example below,
we will use <code class="docutils literal"><span class="pre">confidential</span></code>. As always - consult <a class="reference external" href="https://tools.ietf.org/html/rfc6749">rfc6749</a> for more context.</p>
<p><code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">/api/users/applications/</span></code> a payload similar to this example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;client_type&quot;</span><span class="o">:</span> <span class="s2">&quot;confidential&quot;</span><span class="p">,</span>
    <span class="s2">&quot;authorization_grant_type&quot;</span><span class="o">:</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Demo / Docs Application&quot;</span><span class="p">,</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A successful <code class="docutils literal"><span class="pre">POST</span></code> will get back a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">201</span> <span class="pre">CREATED</span></code> response, and
a representation of the new application. This example request got back
this representation:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;client_id&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;redacted&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;redirect_uris&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_type&quot;</span><span class="o">:</span> <span class="s2">&quot;confidential&quot;</span><span class="p">,</span>
    <span class="s2">&quot;authorization_grant_type&quot;</span><span class="o">:</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
    <span class="s2">&quot;client_secret&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;redacted&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Demo / Docs Application&quot;</span><span class="p">,</span>
    <span class="s2">&quot;skip_authorization&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>The <cite>client_id</cite> and <cite>client_secret</cite> fields were automatically assigned.</li>
<li>The <cite>skip_authorization</cite> and <cite>redirect_urls</cite> fields have default values.</li>
<li>A single user can be associated with multiple applications.</li>
</ul>
</div>
</div>
<div class="section" id="authenticating-using-oauth2-tokens">
<h5>Authenticating using OAuth2 tokens<a class="headerlink" href="#authenticating-using-oauth2-tokens" title="Permalink to this headline">¶</a></h5>
<p>First,  obtain an access token by <code class="docutils literal"><span class="pre">POST</span></code> ing the user&#8217;s credentials to
<code class="docutils literal"><span class="pre">/o/token/</span></code>. For example:</p>
<div class="highlight-text"><div class="highlight"><pre>curl -X POST -d &quot;grant_type=password&amp;username=serikalikuu@mfltest.slade360.co.ke&amp;password=serikalikuu&quot; http://sfzgvKKVpLxyHn3EbZrepehJnLn1r0OOFnuqBNy7:7SMXKum5CJVWABxIitwszES3Kls5RTBzYzJDI5jdvgPcw0vSjP5pnlYHfANSkPyn8pzSfyi5ETesPGXbbiKih0D3YRjE49IlsMShJy0p6pxLOLp72UKsNKxnj08H0fXP@localhost:8000/o/token/
</pre></div>
</div>
<p>Which breaks down as:</p>
<div class="highlight-text"><div class="highlight"><pre>curl -X POST -d grant_type=&lt;grant_type&gt;&amp;username=&lt;email&gt;&amp;password=&lt;password&gt;&quot; http://&lt;client_id&gt;:&lt;client_secret&gt;@&lt;host&gt;:&lt;por&gt;/o/token/
</pre></div>
</div>
<p>If you authenticate successfully, the reply from the server will be a <cite>JSON</cite>
payload that has the issued access token, the refresh token, the access token
type, expiry and scope. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;access_token&quot;</span><span class="o">:</span> <span class="s2">&quot;fKDvh2fFLR1iFPuB26RUEalbjYO4rx&quot;</span><span class="p">,</span>
    <span class="s2">&quot;token_type&quot;</span><span class="o">:</span> <span class="s2">&quot;Bearer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;expires_in&quot;</span><span class="o">:</span> <span class="mi">36000</span><span class="p">,</span>
    <span class="s2">&quot;refresh_token&quot;</span><span class="o">:</span> <span class="s2">&quot;jLwpCh3WbOXBeb01XMeZR5AQYedkj1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;scope&quot;</span><span class="o">:</span> <span class="s2">&quot;read write&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pick the <code class="docutils literal"><span class="pre">access_token</span></code> and send it in an <code class="docutils literal"><span class="pre">Authorization:</span> <span class="pre">Bearer</span></code> header
e.g</p>
<div class="highlight-text"><div class="highlight"><pre>curl -H &quot;Authorization: Bearer ziBLqoXwVEA8lW9yEmE260AZ4lCJHq&quot; http://localhost:8000/api/common/counties/
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2>Authorization<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>This server&#8217;s <a class="reference external" href="http://en.wikipedia.org/wiki/Role-based_access_control">Role Based Access Control</a> setup is based on the
<a class="reference external" href="https://docs.djangoproject.com/en/1.8/topics/auth/default/#topic-authorization">Django framework permissions and authorization</a> system.</p>
<div class="section" id="understanding-the-role-based-access-control-setup">
<h3>Understanding the role based access control setup<a class="headerlink" href="#understanding-the-role-based-access-control-setup" title="Permalink to this headline">¶</a></h3>
<p>The user details API endpoint ( explained above ) returns the logged in user&#8217;s
permissions.</p>
<p>A user&#8217;s permissions come from three &#8220;sources&#8221;:</p>
<blockquote>
<div><ul class="simple">
<li>the permissions assigned to the group ( role ) that the user belongs to</li>
<li>the permissions assigned directly to the user</li>
<li>the <code class="docutils literal"><span class="pre">is_superuser</span></code> boolean flag; a user who is a &#8220;superuser&#8221; automatically gets all permissions</li>
</ul>
</div></blockquote>
<p>The MFL API server has an additional &#8220;layer&#8221; of authorization: whether a user
is a &#8220;national user&#8221; or a &#8220;county user&#8221;. In certain list endpoints ( chiefly
those that deal directly with facilities ), a &#8220;county&#8221; user will have their
results limited to facilities that are located in their county.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This API server does not support &#8220;true&#8221; unauthenticated read-only access
For the public site, OAuth2 credentials ( that correspond to a role with
limited access ) will be used.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">From the point of view of the MFL API, regulator systems are just one more
set of API clients.</p>
</div>
</div>
<div class="section" id="users-and-counties">
<h3>Users and counties<a class="headerlink" href="#users-and-counties" title="Permalink to this headline">¶</a></h3>
<p>In 2010, Kenya got a new constitution. One of the major changes was the
establishment of a devolved system of government.</p>
<p>The second generation MFL API ( this server ) is designed for the era of
devolution. In this system, facility record management should occur at the
county level.</p>
<p>The separation of privileges between data entry staff ( &#8220;makers&#8221; ) and those
responsible for approval ( &#8220;checkers&#8221; ) can be modelled easily using the
role based access control setup described above.</p>
<p>The only additional need is the need to link county level users to counties,
and use that information to limit their access. This has been achieved by
adding an <code class="docutils literal"><span class="pre">is_national</span></code> boolean flag to the custom user model and adding a
resource that links users to counties. The example user resource below
represents a non-national ( county ) user ( note the <code class="docutils literal"><span class="pre">is_national</span></code> field ):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;short_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Serikali&quot;</span><span class="p">,</span>
    <span class="s2">&quot;full_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Serikali Ndogo &quot;</span><span class="p">,</span>
    <span class="s2">&quot;all_permissions&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s2">&quot;common.add_town&quot;</span><span class="p">,</span>
        <span class="c1">// many more permissions</span>
    <span class="p">],</span>
    <span class="s2">&quot;user_permissions&quot;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s2">&quot;groups&quot;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s2">&quot;last_login&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;is_superuser&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;serikalindogo@mfltest.slade360.co.ke&quot;</span><span class="p">,</span>
    <span class="s2">&quot;first_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Serikali&quot;</span><span class="p">,</span>
    <span class="s2">&quot;last_name&quot;</span><span class="o">:</span> <span class="s2">&quot;Ndogo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;other_names&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="o">:</span> <span class="s2">&quot;serikalindogo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_staff&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;is_active&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;date_joined&quot;</span><span class="o">:</span> <span class="s2">&quot;2015-05-03T02:39:03.443301Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_national&quot;</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to link a user to a county, you need to have two pieces of
information:</p>
<blockquote>
<div><ul class="simple">
<li>the user&#8217;s <code class="docutils literal"><span class="pre">id</span></code></li>
<li>the county&#8217;s <code class="docutils literal"><span class="pre">id</span></code> - easily obtained from <code class="docutils literal"><span class="pre">/api/common/counties/</span></code></li>
</ul>
</div></blockquote>
<p>With these two pieces of information in place, <code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">/api/common/user_counties/</span></code> a payload similar to this example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;county&quot;</span><span class="o">:</span> <span class="s2">&quot;d5f54838-8743-4774-a866-75d7744a9814&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A successful operation will get back a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">201</span> <span class="pre">CREATED</span></code> response and
a representation of the newly created resource. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;073d8bfa-2a86-4f9a-9cbe-0b8ac6780c3a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;created&quot;</span><span class="o">:</span> <span class="s2">&quot;2015-05-04T17:44:56.441006Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;updated&quot;</span><span class="o">:</span> <span class="s2">&quot;2015-05-04T17:44:56.441027Z&quot;</span><span class="p">,</span>
    <span class="s2">&quot;deleted&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">&quot;active&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">&quot;created_by&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;updated_by&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;county&quot;</span><span class="o">:</span> <span class="s2">&quot;d5f54838-8743-4774-a866-75d7744a9814&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The filtering of results by county is transparent ( the API client does not
need to do anything ).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A user can only have one active link to a county at any particular time.
Any attempt to link a user to more than one county at a time will get a
validation error.</p>
<p>If you&#8217;d like to change the county that a user is linked to, you will need
to first inactivate the existing record ( <code class="docutils literal"><span class="pre">PATCH</span></code> it and set <code class="docutils literal"><span class="pre">active</span></code>
to <code class="docutils literal"><span class="pre">false</span></code> ).</p>
<p class="last">In order to determine the role that a user is currently linked to, issue a
<code class="docutils literal"><span class="pre">GET</span></code> similar to <code class="docutils literal"><span class="pre">/api/common/user_counties/?user=4&amp;active=true</span></code>. In
this example, <code class="docutils literal"><span class="pre">4</span></code> is the user&#8217;s <code class="docutils literal"><span class="pre">id</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="setting-up-users-permissions-and-groups">
<h2>Setting up users, permissions and groups<a class="headerlink" href="#setting-up-users-permissions-and-groups" title="Permalink to this headline">¶</a></h2>
<div class="section" id="permissions">
<h3>Permissions<a class="headerlink" href="#permissions" title="Permalink to this headline">¶</a></h3>
<p>API clients should treat permissions as &#8220;fixed&#8221; builtins. The server does not
implement any endpoint that can be used to add, edit or remove a permission.</p>
<p>The available permissions can be listed by issuing a <code class="docutils literal"><span class="pre">GET</span></code> to
<code class="docutils literal"><span class="pre">/api/users/permissions/</span></code>. The results will look like this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="o">:</span> <span class="mi">216</span><span class="p">,</span>
    <span class="s2">&quot;next&quot;</span><span class="o">:</span> <span class="s2">&quot;http://localhost:8000/api/users/permissions/?page=2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;previous&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;results&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">61</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Can add email address&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codename&quot;</span><span class="o">:</span> <span class="s2">&quot;add_emailaddress&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="mi">21</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">62</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Can change email address&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codename&quot;</span><span class="o">:</span> <span class="s2">&quot;change_emailaddress&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="mi">21</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">63</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Can delete email address&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codename&quot;</span><span class="o">:</span> <span class="s2">&quot;delete_emailaddress&quot;</span><span class="p">,</span>
            <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="mi">21</span>
        <span class="p">},</span>
        <span class="c1">// truncated for brevity</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <cite>content_type</cite> keys in the example above originate from
<a class="reference external" href="https://docs.djangoproject.com/en/1.8/ref/contrib/contenttypes/">Django&#8217;s contenttypes framework</a>. For an API consumer, they are an
implementation detail / curiosity; API clients will nto need to know more
about them.</p>
</div>
</div>
<div class="section" id="groups">
<h3>Groups<a class="headerlink" href="#groups" title="Permalink to this headline">¶</a></h3>
<p>The API server provides APIs that can be used to create roles, alter existing
roles and retire roles.</p>
<p>Existing roles ( groups ) can be listed by issuing a <code class="docutils literal"><span class="pre">GET</span></code> to
<code class="docutils literal"><span class="pre">/api/users/groups/</span></code>.</p>
<div class="section" id="creating-a-new-role">
<h4>Creating a new role<a class="headerlink" href="#creating-a-new-role" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">/api/users/groups/</span></code> a payload that similar to the one below:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Documentation Example Group&quot;</span><span class="p">,</span>
    <span class="s2">&quot;permissions&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">61</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Can add email address&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codename&quot;</span><span class="o">:</span> <span class="s2">&quot;add_emailaddress&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">62</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Can change email address&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codename&quot;</span><span class="o">:</span> <span class="s2">&quot;change_emailaddress&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A successful operation will get back a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">201</span> <span class="pre">CREATED</span></code> status.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must supply both a <code class="docutils literal"><span class="pre">name</span></code> and <code class="docutils literal"><span class="pre">permissions</span></code>.</p>
</div>
</div>
<div class="section" id="updating-an-existing-role">
<h4>Updating an existing role<a class="headerlink" href="#updating-an-existing-role" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal"><span class="pre">PUT</span></code> or <code class="docutils literal"><span class="pre">PATCH</span></code> to a group <strong>detail URL</strong> e.g <code class="docutils literal"><span class="pre">/api/users/groups/1/</span></code>.</p>
<p>For example, to take away from the example role the &#8220;Can change email address&#8221;
permission, the following <code class="docutils literal"><span class="pre">PATCH</span></code> request should be sent:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;permissions&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">61</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Can add email address&quot;</span><span class="p">,</span>
            <span class="s2">&quot;codename&quot;</span><span class="o">:</span> <span class="s2">&quot;add_emailaddress&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A similar approach will be followed to add permissions.</p>
<p>A successful operation will get back a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">200</span> <span class="pre">OK</span></code> status.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Permissions will always be overwritten</strong> when you perform an update.</p>
</div>
</div>
</div>
</div>
<div class="section" id="user-management">
<h2>User management<a class="headerlink" href="#user-management" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-registration-sign-up">
<h3>User registration ( sign up )<a class="headerlink" href="#user-registration-sign-up" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">POST</span></code> to <code class="docutils literal"><span class="pre">/api/rest-auth/registration/</span></code> a payload similar to this example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;username&quot;</span><span class="o">:</span> <span class="s2">&quot;likeforreal&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;likeforreal@yodawg.dawg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password1&quot;</span><span class="o">:</span> <span class="s2">&quot;most_secure_password_in_the_world_like_for_real&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password2&quot;</span><span class="o">:</span> <span class="s2">&quot;most_secure_password_in_the_world_like_for_real&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A successful operation will get back a <code class="docutils literal"><span class="pre">HTTP</span> <span class="pre">201</span> <span class="pre">CREATED</span></code> response and
a representation of the new user. For example:</p>
<div class="highlight-text"><div class="highlight"><pre>HTTP 201 CREATED
Content-Type: application/json
Vary: Accept
Allow: POST, OPTIONS, HEAD

{
    &quot;id&quot;: 9,
    &quot;short_name&quot;: &quot;&quot;,
    &quot;full_name&quot;: &quot;  &quot;,
    &quot;all_permissions&quot;: [],
    &quot;user_permissions&quot;: [],
    &quot;groups&quot;: [],
    &quot;last_login&quot;: &quot;2015-05-05T09:12:01.888514Z&quot;,
    &quot;is_superuser&quot;: false,
    &quot;email&quot;: &quot;likeforreal1@yodawg.dawg&quot;,
    &quot;first_name&quot;: &quot;&quot;,
    &quot;last_name&quot;: &quot;&quot;,
    &quot;other_names&quot;: &quot;&quot;,
    &quot;username&quot;: &quot;likeforreal1&quot;,
    &quot;is_staff&quot;: false,
    &quot;is_active&quot;: true,
    &quot;date_joined&quot;: &quot;2015-05-05T09:12:01.790167Z&quot;,
    &quot;is_national&quot;: false
}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This API server does not implement email address confirmation.
A future release might implement that.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The registration operation described above suffices, for public users.</p>
</div>
<p>The manner in which users should be linked to counties has already been
discussed in the Authorization section.</p>
</div>
<div class="section" id="linking-users-to-groups">
<h3>Linking users to groups<a class="headerlink" href="#linking-users-to-groups" title="Permalink to this headline">¶</a></h3>
<p>In order to assign a user to a group, you will need to know the group
ID ( which you can obtain from <code class="docutils literal"><span class="pre">/api/groups/</span></code> ).</p>
<p><code class="docutils literal"><span class="pre">PATCH</span></code> an already existing user with a payload similar to this example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;groups&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Documentation Example Group&quot;</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to remove them from their assigned roles, <code class="docutils literal"><span class="pre">PATCH</span></code> with an empty
<code class="docutils literal"><span class="pre">groups</span></code> list.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This server does not support the direct assignment of permissions to users.
That is deliberate.</p>
</div>
</div>
<div class="section" id="updating-user-details">
<h3>Updating user details<a class="headerlink" href="#updating-user-details" title="Permalink to this headline">¶</a></h3>
<p>Every writable attribute of a user record can be <code class="docutils literal"><span class="pre">PATCH``ed.</span> <span class="pre">For</span> <span class="pre">example,</span>
<span class="pre">to</span> <span class="pre">inactivate</span> <span class="pre">or</span> <span class="pre">retire</span> <span class="pre">a</span> <span class="pre">user,</span> <span class="pre">``PATCH</span></code> the user&#8217;s ( detail ) record and set
<code class="docutils literal"><span class="pre">is_active</span></code> to <code class="docutils literal"><span class="pre">false</span></code>.</p>
<p>For example: if the detail record for the user we registered above
( <code class="docutils literal"><span class="pre">likeforreal</span></code> ) is to be found at <code class="docutils literal"><span class="pre">/api/users/9/</span></code>, the user can be
inactivated by <code class="docutils literal"><span class="pre">PATCH</span></code> ing <code class="docutils literal"><span class="pre">/api/users/9/</span></code> with:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;active&quot;</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The same general approach can be used for any other flag e.g
<code class="docutils literal"><span class="pre">is_superuser</span></code>.</p>
</div>
</div>
<div class="section" id="password-changes">
<h3>Password changes<a class="headerlink" href="#password-changes" title="Permalink to this headline">¶</a></h3>
<p>The password of the <strong>logged in user</strong> can be changed by making a <code class="docutils literal"><span class="pre">POST</span></code> to
<code class="docutils literal"><span class="pre">/api/rest-auth/password/change/</span></code> a payload similar to this example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;old_password&quot;</span><span class="o">:</span> <span class="s2">&quot;oldanddonewith&quot;</span><span class="p">,</span>
    <span class="s2">&quot;new_password1&quot;</span><span class="o">:</span> <span class="s2">&quot;newhotness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;new_password2&quot;</span><span class="o">:</span> <span class="s2">&quot;newhotness&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A future version of this server may add support for social authentication
e.g login via Facebook, Twitter or Google accounts.</p>
</div>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Supply Chain 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, sci devs.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>